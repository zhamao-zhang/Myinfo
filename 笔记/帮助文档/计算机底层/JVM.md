# JVM结构体系

![image-20210120140201298](F:\图像\typora图像保存位置\image-20210120140201298.png)



JVM的垃圾回收机制 不会对栈区进行垃圾回收, 因为栈中不存在垃圾.





# 双亲委派机制

## 2.0版本的理解

**看到了一句很好地总结   从子到父,再从父到子的过程就叫双亲委派机制**

```
一个.java文件  编译成.class文件也叫字节码文件 .   然后再由类加载器 去加载.class文件.  

在加载时, 会先由 应用程序加载器来判断 是否加载过, 没有的话就上抛给父类加载器. 也就是 jre/lib/exc 目录下的 .jar  包   如果仍然没有加载的话  就上抛给 BOOT 也就根目录.     java库里的源码 都是BOOT目录下.       当.class文件 委托到最上层的加载器时 ,才开始判断  该加载器到底能不能加载这个.class文件.  不能的话   就要向下委托  开始那个从父到子的过程.

直到 .class文件 被加载了为止.


这么做的好处   最明显的一点就是  可以防止  库代码 被篡改,  无论在应用程序里怎么重写 根目录下的类代码  , 最后执行时  JVM也不会加载你重写的代码,而是加载根目录下的. 大大的保证了安全性.   

```







## 1.0版本的理解

```
 在我们 的 jre下面  有一个 根目录   BOOT     还有一个扩展目录 EXC     我们的 类加载 时   是 从最下面 开始 逐步往上找   ,  

具体步骤为,     APP>>EXC>>BOOT        当我们调用 java库中的 类时,  他会逐步往上找,     最终在 BOOT下 找到  该类的.class文件,    然后执行 该.class文件中的代码.      

其实 每一个.class文件 都会执行这个逐步往上找的过程.  找到 BOOT 如果 BOOT中没有的话,会往下一层EXC中找,  再没有的话 就在APP 中找.     

比如我们自定义的一些类,  其实最后都是经历了 从 APP>>EXC>>BOOT>>EXC>>APP 的寻找过程.  

如果我们在APP层 重写了 EXC目录下 或者 BOOT目录下的类代码.   执行的时候 也不会加载我们重写的那些数据.     而是 jre中保存的更高层的源码数据.

   
```

![image-20210120153315108](F:\图像\typora图像保存位置\image-20210120153315108.png)





**当然 有的时候 根目录加载器 也会出现 为 NULL 的情况  .**    

**第一种是 因为 找不到.class 而导致的 NULL现象 ** 

**第二种 就是  java调不到该类加载器,  因为这个东西不属于java  native** 

我们知道 java代码底层是用 c++写的,   所以 java类加载器 根本不可能加载c++的东西 , 调用不到. 所以才会出现 为 NULL 的现象.     并不是这个东西不存在. 



那么既然 java调用不到, 我们程序运行,为什么 没有崩溃呢   是因为,native关键字.      下面是 百度百科中的解释

```
native是一个计算机函数，一个Native Method就是一个Java调用非Java代码的接口。方法的实现由非Java语言实现，比如C或C++。

native可以与所有其它的java标识符连用，但是abstract除外。这是合理的，因为native暗示这些方法是有实现体的，只不过这些实现体是非java的，但是abstract却显然的指明这些方法无实现体。native与其它java标识符连用时，其意义同非Native Method并无差别，比如native static表明这个方法可以在不产生类的实例时直接调用，这非常方便，比如当你想用一个native method去调用一个C的类库时。上面的第三个方法用到了native synchronized，JVM在进入这个方法的实现体之前会执行同步锁机制（就像java的多线程。）
```



打个比方说 就是 java把这个功能 给外包出去了  交给了别的编程语言来做.  别的编程语言做出来的 结果.  再以一个java能够理解的方式 返回给java. 懂了吧.





# 程序计数器and方法区

每一个线程都有一个程序计数器,是线程私有的,就是一个指针.指向方法区中的方法字节码,是一个非常小的内存空间,几乎可以忽略不计



![image-20210120181006505](F:\图像\typora图像保存位置\image-20210120181006505.png)



